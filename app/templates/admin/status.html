{% extends 'layouts/dashboard.base.html' %}
{% block title %}Flaskdesk â€” Statuses{% endblock %}
{% block content %}

<div class="d-flex" id="wrapper">
  <!-- Sidebar -->
  {% include 'includes/sidebar.admin.html' %}

  <!-- Website content -->
  <div class="content">
    <!-- Navbar top fixed -->
    {% include 'includes/navbar.admin.html' %}

    <!-- Content container -->
    <div class="container-fluid">
      <!-- Header -->
      <div class="content-box mb-3 content-lighten">
        <div class="row">
          <div class="col-md-6">
            <h3>Statuses</h3>
          </div>
          <div class="col-md-6">
            <div class="text-right mt-1">
              <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#createModal">
                Create new
              </button>
            </div>
          </div>
        </div>
      </div>

      {% with messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }}" role="alert">
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <table id="table" class="table table-responsive-sm bg-white">
        <thead>
          <tr>
            <th>Status</th>
            <th>Date Created</th>
            <th data-orderable="false">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for row in statuses %}
          <tr>
            <td>{{ row.status }}</td>
            <td>{{ row.date_created }}</td>
            <td>
              <button type="button" class="btn btn-sm btn-primary"
              {% if row.id <= 4 %}
                disabled
              {% else %}
                data-toggle="modal" data-target="#updateModal{{ row.id }}"
              {% endif %}>
                <i class="fa fa-edit"></i>
              </button>
              <button type="button" class="btn btn-sm btn-danger"
              {% if row.id <= 4 %}
                disabled
              {% else %}
                data-toggle="modal" data-target="#deleteModal{{ row.id }}"
              {% endif %}>
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr>
          <!-- Update Modal -->
          <div class="modal fade" id="updateModal{{ row.id }}" tabindex="-1" aria-labelledby="updateModalLabel{{ row.id }}" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="updateModalLabel{{ row.id }}">Update Status</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <form action="{{ url_for('admin.update_status') }}" method="POST">
                    {{ form.hidden_tag() }}
                    <div class="form-group">
                      <input type="hidden" name="id" value="{{ row.id }}">
                      {% if form.status.errors %}
                        {{ form.status(class="form-control is-invalid", value=row.status, placeholder="Status") }}
                        {% for error in form.status.errors %}
                          <div class="invalid-feedback">
                            {{ error }}
                          </div>
                        {% endfor %}
                      {% else %}
                        {{ form.status(class="form-control", value=row.status, placeholder="Status") }}
                      {% endif %}
                    </div>
                    <button type="submit" class="btn btn-primary">Update</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!-- Delete Modal -->
          <div class="modal fade" id="deleteModal{{ row.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel{{ row.id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="deleteModalLabel{{ row.id }}">Delete Confirmation</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <p>Are you sure you want to delete this status? This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <form action="{{ url_for('admin.delete_status', id=row.id) }}" method="POST" role="form">
                    <input type="submit" class="btn btn-danger" value="Delete">
                  </form>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Create Modal -->
    <div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">Create New</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form action="{{ url_for('admin.status') }}" method="POST">
              {{ form.csrf_token }}
              <div class="form-group">
                {% if form.status.errors %}
                  {{ form.status(class="form-control is-invalid", placeholder="Status") }}
                  {% for error in form.status.errors %}
                    <div class="invalid-feedback">
                      {{ error }}
                    </div>
                  {% endfor %}
                {% else %}
                  {{ form.status(class="form-control", placeholder="Status") }}
                {% endif %}
              </div>
              <button type="submit" class="btn btn-primary">Create</button>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}